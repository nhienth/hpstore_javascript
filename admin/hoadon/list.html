<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="icon"
      href="//bizweb.dktcdn.net/100/180/515/themes/683553/assets/favicon.png?1624423469475"
      type="image/x-icon"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
      integrity="sha512-SfTiTlX6kk+qitfevl/7LibUOeJWlt9rbyDn92a1DqWOw9vWG2MFoays0sgObmWazO5BQPiFucnnEAjpAB+/Sw=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <script
      src="https://kit.fontawesome.com/497e58feb8.js"
      crossorigin="anonymous"
    ></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Fira+Sans:ital,wght@0,300;0,400;0,500;0,700;1,300;1,400;1,700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="../../content/css/reset.css" />
    <link rel="stylesheet" href="../../content/css/app.css" />
    <link rel="stylesheet" href="../../content/css/main.css" />
    <link rel="stylesheet" href="../../content/css/admin.css" />
    <link rel="stylesheet" href="../../content/css/admin-form.css" />
    <title>HPstore - Quản trị website</title>
  </head>
  <body>
    <div class="container">
      <div class="admin-layout">
        <div class="layout-left">
          <div class="left-logo">
            <img src="../../content/images/home/logo.png" alt="" />
          </div>
          <div class="left-emelent">
            <div class="left-element--content">
              <a href="../index.html" class="none-after"
                ><i class="fas fa-tv"></i> Trang chủ admin</a
              >
            </div>
          </div>
          <div class="left-emelent">
            <div class="left-element--title">Quản lý tài khoản</div>
            <div class="left-element--content">
              <div class="more-function">
                <a href="../khachhang/add.html">Thêm tài khoản</a>
                <a href="../khachhang/list.html">Danh sách</a>
              </div>
              <a href="../khachhang/list.html"
                ><i class="fas fa-user"></i> Tài khoản</a
              >
            </div>
          </div>
          <div class="left-emelent">
            <div class="left-element--title">Quản lý danh mục</div>
            <div class="left-element--content">
              <div class="more-function">
                <a href="../danhmuc/add.html">Thêm danh mục</a>
                <a href="../danhmuc/list.html">Danh sách</a>
              </div>
              <a href="../danhmuc/list.html"
                ><i class="fas fa-copyright"></i> Danh mục</a
              >
            </div>
          </div>
          <div class="left-emelent">
            <div class="left-element--title">Quản lý sản phẩm</div>
            <div class="left-element--content">
              <div class="more-function">
                <a href="../hanghoa/add.html">Thêm sản phẩm</a>
                <a href="../hanghoa/list.html">Danh sách</a>
              </div>
              <a href="../hanghoa/list.html"
                ><i class="fas fa-volleyball-ball"></i> Sản phẩm</a
              >
            </div>
          </div>
          <div class="left-emelent">
            <div class="left-element--title">Quản lý đơn hàng</div>
            <div class="left-element--content">
              <a href="../hoadon/list.html"
                ><i class="fas fa-people-carry"></i> Đơn hàng</a
              >
            </div>
          </div>
          <div class="left-emelent">
            <div class="left-element--title">Quản lý bình luận</div>
            <div class="left-element--content">
              <a href="../binhluan/list.html"
                ><i class="fas fa-comment-alt"></i> Bình luận</a
              >
            </div>
          </div>
          <div class="left-emelent">
            <div class="left-element--title">Quản lý tin tức</div>
            <div class="left-element--content">
              <div class="more-function">
                <a href="../tintuc">Thêm tin tức</a>
                <a href="../tintuc/list.html">Danh sách tin tức</a>
              </div>
              <a href="../tintuc/list.html"
                ><i class="fas fa-newspaper"></i> Tin tức</a
              >
            </div>
          </div>
          <div class="left-emelent">
            <div class="left-element--title">Quản lý thống kê</div>
            <div class="left-element--content">
              <div class="more-function">
                <a href="">Hàng hóa</a>
                <a href="">Đơn hàng</a>
              </div>
              <a href=""><i class="fas fa-chart-pie"></i> Thống kê</a>
            </div>
          </div>
        </div>

        <div class="layout-right">
          <div class="right-top">
            <div class="website-title">Trang quản trị websitie</div>
            <div class="admin-info">
              <div class="admin-name">ADMIN</div>
              <div class="admin-img">
                <img src="../../uploads/Luffy.jfif" />
              </div>
            </div>
          </div>
          <div class="right-bgc">
            <div class="layout-function">
              <div class="function-title">Danh sách đơn hàng</div>
              <div class="function-table">
                <table class="tabel-list--normal" id="table-order">
                  <tr>
                    <th>Mã đơn</th>
                    <th>Người đặt hàng</th>
                    <th>Tổng tiền</th>
                    <th>Hình thức thanh toán</th>
                    <th>Trạng thái</th>
                    <th>Cập nhật trạng thái</th>
                    <th>Xem chi tiết</th>
                  </tr>

                  <tr>
                    <td>01</td>
                    <td>Tran Hiang Nhiem</td>
                    <td>1200000</td>
                    <td>Thanh toán online</td>
                    <td>
                      <div class="mediumturquoise status-bill">
                        Đang giao hàng
                      </div>
                    </td>
                    <td>
                      <form action="" method="post" class="bill-form">
                        <input type="hidden" name="ma_hoadon" value="" />
                        <select name="trang_thai" id="">
                          <option value="0">Đơn hàng mới</option>
                          <option value="1">Đã xác nhận</option>
                          <option value="2">Đang giao hàng</option>
                          <option value="3">Đã hoàn thành</option>
                        </select>
                        <button type="submit" name="btn-update">
                          Cập nhật
                        </button>
                      </form>
                    </td>
                    <td>
                      <a href="" class="a-edit"><i class="fas fa-eye"></i></a>
                    </td>
                  </tr>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script src="../mainn.js"></script>
    <script>
      var orderApi = "http://localhost:3000/orders?_sort=id&_order=desc";

      loadOrder();

      function loadOrder() {
        fetch(orderApi)
          .then((response) => response.json())
          .then((data) => {
            console.log(data);
            var htmls = `
            <tr>
              <th>Mã đơn</th>
              <th>Người đặt hàng</th>
              <th>Tổng tiền</th>
              <th>Hình thức thanh toán</th>
              <th>Trạng thái</th>
              <th>Cập nhật trạng thái</th>
              <th>Xem chi tiết</th>
            </tr>
          `;
            data.forEach((bill) => {
              var status = "";
              var bgc = "";
              var hidden = "";
              if (bill.payment == 0) {
                bill.payment = "Thanh toán khi nhận hàng";
              } else {
                bill.payment = "Thanh toán online";
              }

              if (bill.status == 0) {
                status = "Đơn hàng mới";
                bgc = "sandybrown";
              } else if (bill.status == 1) {
                status = "Đã xác nhận";
                bgc = "royalblue";
              } else if (bill.status == 2) {
                status = "Đang giao hàng";
                bgc = "mediumturquoise";
              } else if (bill.status == 3) {
                status = "Đã hoàn thành";
                bgc = "lightseagreen";
              } else {
                status = "Đã hủy";
                bgc = "dimgray";
                hidden = "style=display:none";
              }
              htmls += `
              <tr>
                <td>${bill.id}</td>
                <td>${bill.customer_name}</td>
                <td>${numberWithCommas(bill.total_money)}đ</td>
                <td>${bill.payment}</td>
                <td>
                  <div class="${bgc} status-bill">
                    ${status}
                  </div>
                </td>
                <td>
                  <div class="bill-form" ${hidden}>
                    <input type="hidden" name="ma_hoadon" value="" />
                    <select name="trang_thai" id="status-order" class="SO-${
                      bill.id
                    }">
                      <option value="0" class="sta-0">Đơn hàng mới</option>
                      <option value="1" class="sta-1">Đã xác nhận</option>
                      <option value="2" class="sta-2">Đang giao hàng</option>
                      <option value="3" class="sta-3">Đã hoàn thành</option>
                    </select>
                    <button name="btn-update" onclick="updateOrder(${bill.id})">
                      Cập nhật
                    </button>
                  </div>
                </td>
                <td>
                  <a href="details.html?id=${
                    bill.id
                  }" class="a-edit"><i class="fas fa-eye"></i></a>
           
                </td>
              </tr>
            `;
              // setTimeout(() => {
              //   var status = document.querySelector(".sta-" + bill.status);
              //   setTimeout(() => {
              //     document.querySelector(".sta-" + bill.status).selected = true;
              //   }, 3000);
              // }, 100);
            });

            document.querySelector("#table-order").innerHTML = htmls;
          });
      }

      function updateOrder(id) {
        var value = document.querySelector(".SO-" + id).value;
        console.log(value);
        fetch("http://localhost:3000/orders/" + id, {
          method: "PATCH",
          headers: {
            "Content-Type": "application/json",
            // "Content-Type": "application/x-www-form-urlencoded",
          },
          body: JSON.stringify({ status: value }),
        }).then((response) => response.json());
      }
    </script>
  </body>
</html>
